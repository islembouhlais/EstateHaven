package project.app.demo.user;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.dao.DataAccessException;import org.springframework.jdbc.core.JdbcTemplate;import org.springframework.jdbc.core.RowMapper;import org.springframework.jdbc.support.GeneratedKeyHolder;import org.springframework.jdbc.support.KeyHolder;import org.springframework.stereotype.Repository;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.sql.SQLException;import java.sql.Statement;import java.util.List;@Repositorypublic class userRepository {    @Autowired    private JdbcTemplate jdbcTemplate;    public String getRoleById(int id) {        String clientQuery = "SELECT COUNT(*) FROM client WHERE client_id = ?";        Integer clientCount = jdbcTemplate.queryForObject(clientQuery, Integer.class, id);        if (clientCount > 0) {            return "client";        }        String sellerQuery = "SELECT COUNT(*) FROM seller WHERE seller_id = ?";        Integer sellerCount = jdbcTemplate.queryForObject(sellerQuery, Integer.class, id);        if (sellerCount > 0) {            return "seller";        }        return "NOT_FOUND";    }    public int insertSession(String role){        String sql="INSERT INTO session(role) values(?)";        KeyHolder keyHolder = new GeneratedKeyHolder();        try {            jdbcTemplate.update(connection -> {                PreparedStatement ps = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);                ps.setString(1,role);                return ps;            }, keyHolder);        }        catch (DataAccessException e) {            throw new RuntimeException("Error inserting user", e);        }        return keyHolder.getKey().intValue();    }public int insertUser(userEntity user) {    String sql = "INSERT INTO user (firstname,lastname,email,password_hash,created_at) VALUES (?,?, ?,?,?)";    KeyHolder keyHolder = new GeneratedKeyHolder();        try {            jdbcTemplate.update(connection -> {                PreparedStatement ps = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS);                ps.setString(1, user.getFirstname());                ps.setString(2,user.getLastname());                ps.setString(3, user.getEmail());                ps.setString(4, user.getPassword_hash());                ps.setTimestamp(5, user.getCreated_at());                return ps;            }, keyHolder);        }        catch (DataAccessException e) {            throw new RuntimeException("Error inserting user", e);        }        return keyHolder.getKey().intValue();   // }   // return -1;}    // Select all users    public List<userEntity> getAllUsers() {        String sql = "SELECT * FROM user";        try {            return jdbcTemplate.query(sql, new UserRowMapper());        } catch (DataAccessException e) {            throw new RuntimeException("Error fetching users", e);        }    }    //Email exist    public userEntity find_user(userEntity user) {        String sql = "SELECT * FROM user WHERE email = ? AND password_hash = ?";        return jdbcTemplate.query(sql, new Object[]{user.getEmail(), user.getPassword_hash()}, rs -> {            if (rs.next()) {                return new UserRowMapper().mapRow(rs,1);            } else {                return null;  // Return null if no matching user is found            }        });}    // Update a user//    public void updateUser(int id, String newName, String newEmail) {//        String sql = "UPDATE user SET name = ?, email = ? WHERE id = ?";//        try {//            jdbcTemplate.update(sql, newName, newEmail, id);//        } catch (DataAccessException e) {//            throw new RuntimeException("Error updating user", e);//        }//    }    // Delete a user//    public void deleteUser(int id) {//        String sql = "DELETE FROM user WHERE id = ?";//        try {//            jdbcTemplate.update(sql, id);//        } catch (DataAccessException e) {//            throw new RuntimeException("Error deleting user", e);//        }//    public userEntity Add_user(userEntity user){////        return null;//    }}    class UserRowMapper implements RowMapper<userEntity> {        @Override        public userEntity mapRow(ResultSet rs, int rowNum) throws SQLException {            userEntity user=new userEntity();            user.setUser_id(rs.getInt("user_id"));            user.setFirstname(rs.getString("firstname"));            user.setLastname((rs.getString("lastname")));            user.setEmail(rs.getString("email"));            return user;        }    }